<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="generator" content="Docusaurus v2.0.0-alpha.58">
<title data-react-helmet="true">Action | Tasit</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:title" content="Action | Tasit"><meta data-react-helmet="true" name="description" content="&lt;!-- ---"><meta data-react-helmet="true" property="og:description" content="&lt;!-- ---"><meta data-react-helmet="true" property="og:url" content="https://docs.tasit.io/docs/Action"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon-32x32.png"><link data-react-helmet="true" rel="canonical" href="https://docs.tasit.io/docs/Action"><link rel="stylesheet" href="/styles.7140246d.css">
<link rel="preload" href="/styles.143f7251.js" as="script">
<link rel="preload" href="/runtime~main.4f999fc1.js" as="script">
<link rel="preload" href="/main.0d28eed8.js" as="script">
<link rel="preload" href="/1.88c1c7a9.js" as="script">
<link rel="preload" href="/2.50d33069.js" as="script">
<link rel="preload" href="/18.8bcd8162.js" as="script">
<link rel="preload" href="/19.9269c973.js" as="script">
<link rel="preload" href="/20ac7829.cd78ded8.js" as="script">
<link rel="preload" href="/17896441.43ff49df.js" as="script">
<link rel="preload" href="/2d9fd45f.79f9030e.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=window.matchMedia("(prefers-color-scheme: dark)"),n=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();null!==n?t(n):e.matches&&t("dark")}()</script><div id="__docusaurus">
<nav class="navbar navbar--light navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/"><img class="navbar__logo" src="/img/TasitLogoSvg.svg" alt="Tasit logo"><strong class="navbar__title">Tasit</strong></a><a class="navbar__item navbar__link" href="/docs/introduction">Docs</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/tasitlabs/tasit-sdk" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_1gtM"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_keGJ moon_1gwN"></span></div><div class="react-toggle-track-x"><span class="toggle_keGJ sun_3CPA"></span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img class="navbar__logo" src="/img/TasitLogoSvg.svg" alt="Tasit logo"><strong class="navbar__title">Tasit</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/introduction">Docs</a></li><li class="menu__list-item"><a href="https://github.com/tasitlabs/tasit-sdk" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_1kjD"><main class="docMainContainer_FFX1"><div class="container padding-vert--lg docItemWrapper_1cc7"><div class="row"><div class="col docItemCol_2GOA"><div class="docItemContainer_2cwg"><article><header><h1 class="docTitle_1vWb">Action</h1></header><div class="markdown"><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="reading-and-writing-data-and-reacting-to-events"></a>Reading and writing data and reacting to events<a aria-hidden="true" tabindex="-1" class="hash-link" href="#reading-and-writing-data-and-reacting-to-events" title="Direct link to heading">#</a></h1><p>This explains how one can use Tasit to interact with smart contracts at different levels of abstraction.</p><p><em>Note:</em> This functionality all &quot;lives&quot; in <code>@tasit/action</code>, a child package of <a href="https://github.com/tasitlabs/tasit-sdk" target="_blank" rel="noopener noreferrer"><code>tasit</code></a> that is also published to npm as a standalone module using <a href="https://lerna.js.org/" target="_blank" rel="noopener noreferrer">lerna</a>.</p><p><a href="https://docs.tasit.io/docs/project-layout" target="_blank" rel="noopener noreferrer">For context, here is an overview</a> of how this fits in with the rest of Tasit.</p><p>Why <code>@tasit/action</code>? <strong>action:</strong> [ak-shən], noun. &quot;a thing done&quot;. It&#x27;s also nice that &quot;act&quot; (the verb form) is part of the words <em>contract</em> and <em>abstraction</em> and <em>transaction</em>. Finally, directors say “action” before starting to film a scene in a movie. Also, since this package supports meta-transactions, it&#x27;s not quite correct to call them transactions. &quot;action&quot; is our catch-all word for transactions and meta-transactions.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="table-of-contents"></a>Table of Contents<a aria-hidden="true" tabindex="-1" class="hash-link" href="#table-of-contents" title="Direct link to heading">#</a></h2><ul><li><a href="#getting-data">Getting data</a></li><li><a href="#setting-data">Setting data</a></li><li><a href="#listening-for-events">Listening for events</a></li><li><a href="#topics-for-the-future">Topics for the future</a></li><li><a href="#notes">Notes</a></li></ul><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="docs"></a>Docs<a aria-hidden="true" tabindex="-1" class="hash-link" href="#docs" title="Direct link to heading">#</a></h1><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="getting-data"></a>Getting data<a aria-hidden="true" tabindex="-1" class="hash-link" href="#getting-data" title="Direct link to heading">#</a></h2><ul><li><a href="#getting-data---decentraland">Decentraland</a></li><li><a href="#getting-data---erc721">ERC721</a></li><li><a href="#getting-data---low-level-tasit-middleware">Low-level Tasit middleware</a></li><li><a href="#getting-data---contract-api-from-ethers">Contract API from ethers</a></li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="getting-data---decentraland"></a>Getting data - Decentraland<a aria-hidden="true" tabindex="-1" class="hash-link" href="#getting-data---decentraland" title="Direct link to heading">#</a></h4><p>Let&#x27;s start at the highest level of abstraction possible, where we can construct our ideal API for the end user assuming we know <code>tasit</code> is being used specifically for the Decentraland contracts.</p><p>I think at this level of abstraction, we don&#x27;t use ERC165 interface detection like we do at lower levels (see below). But actually, using it at all warrants more thought, depending on whether we&#x27;re assuming the user knows the full contract ABI or not (and depending on whether ethers assumes that.)</p><p>We just know the ABI for the open source contracts for that exact project and assume the presence of these functions. The developer can still use the lower-level APIs to confirm, though.</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-javascript codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword module" style="font-style:italic">import</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> </span><span class="token maybe-class-name">Decentraland</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> </span><span class="token keyword module" style="font-style:italic">from</span><span class="token plain"> @tasit</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">action</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// We already know what would have normally been the params here</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// (contractABI, address, etc.)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> decentraland </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">Decentraland</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span></div></div></div></div></div><p>Low-level functions still work</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-javascript codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> balance </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">await</span><span class="token plain"> decentraland</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">balanceOf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">owner</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>Optional: Expose higher-level functions that are specific to this dapp</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-javascript codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// This is not necessarily the name of the function in the contracts</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// but whatever we think would be simplest for the developer using this</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">x</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> y</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">await</span><span class="token plain"> decentraland</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">getLandCoordinates</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">landId</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-javascript codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Decentraland has some land owned by estates which are owned by users</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// and some land owned directly by users</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// You might want to get all the land a user owns even if they have it</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// inside an estate. Now we&#x27;re getting past the standard ERC721 functionality</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// and supporting features specific to Decentraland</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> landIds </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">await</span><span class="token plain"> decentraland</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">getAllLandIdsIncludingEstates</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">userId</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>All of this could be done with a little more work using just the ERC721 abstraction below, though. Under the hood it uses <code>tokenOfOwnerByIndex</code> from ERC721Enumerable, for instance.</p><p>Open questions:</p><ul><li>Whether the address should be configurable at this level of abstraction. For instance, the developer using <code>tasit</code> might know sooner than Tasit project core devs do that a non-upgradeable contract project (that is, a standard smart contract project - not a delegatecall + proxy project) is deploying new contracts and will be using a new interface address from now on.</li><li>Whether the ABI should be in version control in this package or whether we want to add functionality for getting it from the web, using Etherscan&#x27;s API or hopefully a decentralized npm where teams publish generated files like ABIs down the road.</li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="getting-data---erc721"></a>Getting data - ERC721<a aria-hidden="true" tabindex="-1" class="hash-link" href="#getting-data---erc721" title="Direct link to heading">#</a></h4><p>Let&#x27;s now consider a slightly lower level of abstraction, where we can construct our ideal API for the end user assuming we know <code>tasit</code> is being used specifically for an ERC721 (NFT) contract, but not which one until the user instantiates the contract using <code>tasit</code>.</p><p>There&#x27;s functionality for determining what ERC721 features it supports beyond the basic, required ones using ERC165 interface detection.</p><p>Moreso than for an unknown contract with the lower-level <code>@tasit/action</code> API, using ERC165 here is justified because it&#x27;s a first-class feature for extensions of ERC721 in <a href="https://github.com/OpenZeppelin/openzeppelin-solidity/blob/5caecf548c04c97955b8f0487ceb804fab0e2ca1/contracts/token/ERC721/ERC721Metadata.sol#L5">OpenZeppelin</a>.</p><p>But maybe there doesn&#x27;t need to be if we decide the contract ABI will be present for sure. This is an <em>open question</em> for now.</p><p>Anyway, here&#x27;s how to instantiate the contract:</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-javascript codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// TODO: Decide if we can instantiate this with more or less params</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> nft </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">NFT</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">address</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> contractABI</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// or</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> nft </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">NFT</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">address</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// with an assumed ABI</span></div></div></div></div></div><p><code>detectInterfaces()</code> returns an object of ERC721-related interfaces this ERC721 contract supports (since there is a basic ERC721 interface but also some more fully-featured extensions).</p><p>Internally it calls the lower level <code>contract.usesSupportsInterface()</code> first to see if checking for specific interfaces is even worthwhile.</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-javascript codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> supportsMetadata </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">await</span><span class="token plain"> nft</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">detectInterfaces</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">supportsMetadata</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> metadata </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">await</span><span class="token plain"> nft</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">getMetadata</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> tokenURI </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> metadata</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// metadata also contains name and symbol</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></div></div></div></div><p>Alternatively, because tokenURI is just an <code>external</code> or <code>public</code> <code>view</code> function you can get it directly using the underlying &quot;call a contract method&quot; approach you&#x27;ll see used exclusively below in the lower-level <code>@tasit/action</code> library with no prior knowledge about contract type.</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-javascript codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> tokenURI </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">await</span><span class="token plain"> nft</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">tokenURI</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">tokenId</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>Fetching additional metadata from the tokenURI is obviously something we need to support. It doesn&#x27;t feel like it makes sense to have a function for doing this as a <code>nft.xyz(...)</code> method, though.</p><p>Fetching images from additional URIs linked to in the JSON blob available at the main tokenURI will also be a common use case in the app.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="getting-data---low-level-tasit-middleware"></a>Getting data - Low-level Tasit middleware<a aria-hidden="true" tabindex="-1" class="hash-link" href="#getting-data---low-level-tasit-middleware" title="Direct link to heading">#</a></h4><p>A low-level library for calling all of the functions on a given smart contract and listening to events from the smart contract.</p><p>To make this example comparable with the ERC721 example above, let&#x27;s say the contract happens to be of the same type, ERC721.</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-javascript codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// TODO: Finalize way to instantiate contract.</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Maybe just the same as ethers?</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> contract </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">contract</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">address</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> contractABI</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> balance </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">await</span><span class="token plain"> contract</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">balanceOf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">owner</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> owner </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">await</span><span class="token plain"> contract</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">ownerOf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">tokenId</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>Checks whether the contract will let you look up other interfaces it implements using ERC165</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-javascript codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// supportsInterface is a bool</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> supportsInterface </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">await</span><span class="token plain"> contract</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">usesSupportsInterface</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>Let&#x27;s use ERC165 to see if this contract uses the ERC721Metadata extension. Remember, this will be a longer shot because we&#x27;re just using <code>@tasit/action</code>, not the ERC721 abstraction that already &quot;knows&quot; ERC165 is popular for ERC721s. Unlike above where we did <code>nft.detectInterfaces()</code>, we don&#x27;t know the hashes of the interfaces to check for without the prior knowledge of what type of contract this is. So we&#x27;ll need to check for ERC721Metadata using its hash as an argument.</p><p>If we decide the user of <code>tasit</code> has to have the full ABI at this point, maybe this feature is less useful.</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-javascript codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// TODO: Add the proper type conversion, etc.</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Note: This is straight from Solidity - the string as it is probably isn&#x27;t right.</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> </span><span class="token constant" style="color:rgb(130, 170, 255)">INTERFACE_ID_ERC721_METADATA</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;0x5b5e139f&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// 0x5b5e139f ===</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// bytes4(keccak256(&#x27;name()&#x27;)) ^</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// bytes4(keccak256(&#x27;symbol()&#x27;)) ^</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// bytes4(keccak256(&#x27;tokenURI(uint256)&#x27;))</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">//</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// returns a bool</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> supportsMetadata </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">await</span><span class="token plain"> contract</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">supportsInterface</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token constant" style="color:rgb(130, 170, 255)">INTERFACE_ID_ERC721_METADATA</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">supportsMetadata</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> tokenURI </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">await</span><span class="token plain"> contract</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">tokenURI</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">tokenId</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></div></div></div></div><p><em>Ideas for getting clever with ABIs at this level of abstraction:</em></p><p>Find all <code>view</code> (<code>external</code> or <code>public</code>) functions. Assume they&#x27;re the interesting ones for looking up state.</p><p><code>const data = await contract.getAllData()</code></p><p><code>getAllData()</code> does all data-fetching it can in a single call based on what we know from the ABI or from ERC165.</p><p>Possibly even infer from param types what they might do, but that&#x27;s a lot harder.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="getting-data---contract-api-from-ethers"></a>Getting data - Contract API from ethers<a aria-hidden="true" tabindex="-1" class="hash-link" href="#getting-data---contract-api-from-ethers" title="Direct link to heading">#</a></h4><p>Let&#x27;s re-read the <code>@tasit/action</code> section above when it is finalized and see how much it differs from the <a href="https://docs.ethers.io/ethers.js/html/api-contract.html#connecting-to-existing-contracts">ethers abstraction for connecting to contracts</a>.</p><p>We&#x27;ll want to do the same for setting data and listening for events too. As long as there&#x27;s any abstraction we want on top of the ethers contract functions, <code>@tasit/action</code> support for contracts of unknown type seems justified. Setting data / creating transactions is very likely to diverge from the ethers library.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="setting-data"></a>Setting data<a aria-hidden="true" tabindex="-1" class="hash-link" href="#setting-data" title="Direct link to heading">#</a></h2><p>Setting data could possibly be non-async if it&#x27;s like publishing in pubsub. There&#x27;s additional info on this in the <a href="#notes">notes</a> section at the beginning.</p><ul><li><p><a href="#setting-data---low-level-tasit-middleware">Low-level Tasit middleware</a></p></li><li><p><a href="#setting-data---contract-api-from-ethers">Contract API from ethers</a></p></li><li><p><a href="#setting-data---decentraland">Decentraland</a></p></li><li><p><a href="#setting-data---erc721">ERC721</a></p></li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="setting-data---low-level-tasit-middleware"></a>Setting data - Low-level Tasit middleware<a aria-hidden="true" tabindex="-1" class="hash-link" href="#setting-data---low-level-tasit-middleware" title="Direct link to heading">#</a></h4><p>When using the contract abstraction from ethers, the functions for setting data return a transaction hash.</p><p>That&#x27;s too blockchain-y for the target audience. The API is being informed too much by the underlying implementation as opposed to the most understandable abstraction. The <code>@tasit/action</code> API for setting data should be indistinguishable from using pubsub on a non-blockchain architecture.</p><p>So the &quot;set&quot; should return something that lets the user subscribe for the 1st or 7th or nth confirmation of the result, but it shouldn&#x27;t be a tx hash.</p><p>Here&#x27;s one option for how it could work:</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-javascript codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> action </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> contract</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">transferFrom</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword module" style="font-style:italic">from</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> to</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> tokenId</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:rgb(130, 170, 255)">handlerFunction</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token parameter">message</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// message.data = Contents of the message.</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> data </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> message</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> confirmations </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> data</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">confirmations </span><span class="token operator" style="color:rgb(137, 221, 255)">===</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">7</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// do something</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    action</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">unsubscribe</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">action</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">on</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;confirmation&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> handlerFunction</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>You could even imagine pre-attaching a listener with a handlerFunction by default for a few pubsub topics that the user of <code>tasit</code> is likely to want.</p><p>Since remembering to remove the listener is a little clunky, we could also include a variant that unsubscribes after the first message for that topic. This is a pretty common pattern.</p><p><code>contract.once(&quot;enoughConfirmations&quot;, handlerFunction)</code></p><p>For more customization of how this works, during or before sending the transaction the user of <code>tasit</code> could pick which types of events they want to be subscribed to.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="setting-data---contract-api-from-ethers"></a>Setting data - Contract API from ethers<a aria-hidden="true" tabindex="-1" class="hash-link" href="#setting-data---contract-api-from-ethers" title="Direct link to heading">#</a></h4><p>Setting data on a contract returns a tx hash. In the example in the ethers docs, the next step is to <code>await</code> to see that the transaction has been confirmed.</p><p><code>@tasit/action</code> has more of a &quot;optimistic updates&quot; but &quot;be sure to handle error cases&quot; philosophy. Of course that could be achieved with the lower-level ethers API too, but the <code>@tasit/action</code> abstraction gently guides the user towards that approach in a more opinionated fashion.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="setting-data---decentraland"></a>Setting data - Decentraland<a aria-hidden="true" tabindex="-1" class="hash-link" href="#setting-data---decentraland" title="Direct link to heading">#</a></h4><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-javascript codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// TODO: Add me</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// But this far down in in the docs, you can probably</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// extrapolate how this would work from the rest</span></div></div></div></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="setting-data---erc721"></a>Setting data - ERC721<a aria-hidden="true" tabindex="-1" class="hash-link" href="#setting-data---erc721" title="Direct link to heading">#</a></h4><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-javascript codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// TODO: Add me</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// But this far down in in the docs, you can probably</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// extrapolate how this would work from the rest</span></div></div></div></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="listening-for-events"></a>Listening for events<a aria-hidden="true" tabindex="-1" class="hash-link" href="#listening-for-events" title="Direct link to heading">#</a></h2><ul><li><p><a href="#listening-for-events---low-level-tasit-middleware">Low-level Tasit middleware</a></p></li><li><p><a href="#listening-for-events---erc721">ERC721</a></p></li><li><p><a href="#listening-for-events---decentraland">Decentraland</a></p></li><li><p><a href="#listening-for-events---contract-api-from-ethers">Contract API from ethers</a></p></li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="listening-for-events---low-level-tasit-middleware"></a>Listening for events - Low-level Tasit middleware<a aria-hidden="true" tabindex="-1" class="hash-link" href="#listening-for-events---low-level-tasit-middleware" title="Direct link to heading">#</a></h4><p>Listening for events has a similar subcriptions API to the one you use after creating a transaction (see above).</p><p>But unlike for &quot;set&quot; operations, the subscription isn&#x27;t created implicitly.</p><p>Here, it is initiated explicitly with a subscribe function.</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-javascript codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">contract</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">on</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;ExampleEvent&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> handlerFunction</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="listening-for-events---erc721"></a>Listening for events - ERC721<a aria-hidden="true" tabindex="-1" class="hash-link" href="#listening-for-events---erc721" title="Direct link to heading">#</a></h4><p>Note: The ERC721 level of abstraction for listening for events would already know what events to listen for and let you subscribe to them like so:</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-javascript codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Subscriptions is an object where the keys are the event names from ERC721</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">contract</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">onAll</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">handlerFunction</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">contract</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">off</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Transfer&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>In this example there&#x27;s an event <code>Transfer</code> as one of the events supported by ERC721. After unsubscribing from transfer events, you&#x27;re still be subscribed to other events emitted by the contract.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="listening-for-events---decentraland"></a>Listening for events - Decentraland<a aria-hidden="true" tabindex="-1" class="hash-link" href="#listening-for-events---decentraland" title="Direct link to heading">#</a></h4><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-javascript codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// TODO: Add me</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// But this far down in in the docs, you can probably</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// extrapolate how this would work from the rest</span></div></div></div></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="listening-for-events---contract-api-from-ethers"></a>Listening for events - Contract API from ethers<a aria-hidden="true" tabindex="-1" class="hash-link" href="#listening-for-events---contract-api-from-ethers" title="Direct link to heading">#</a></h4><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-javascript codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// TODO: Add me</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// But this far down in in the docs, you can probably</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// extrapolate how this would work from the rest</span></div></div></div></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="topics-for-the-future"></a>Topics for the future<a aria-hidden="true" tabindex="-1" class="hash-link" href="#topics-for-the-future" title="Direct link to heading">#</a></h2><p>Is it worth considering having upgradeable smart contracts being a first-class feature of this package? That would mean not assuming the ABI you have right now will always work. But, it could still assume that there will be a backwards compatibility guarantee and that the existing ABI functions would continue to be supported.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="notes"></a>Notes<a aria-hidden="true" tabindex="-1" class="hash-link" href="#notes" title="Direct link to heading">#</a></h2><p>Getting data is like an HTTP(S) request, so it should be async. Because doing the JSON-RPC request to Infura and getting data back has network lag.</p><p>Setting data could possibly be sync (non-async) if it&#x27;s like publishing in pubsub with no ACK and it&#x27;s instant. It could be async too if we&#x27;re picturing a pubsub approach where successful publication is ACK&#x27;ed, but not instantly. Or if the ACK is instant, then we&#x27;re back to sync.</p><p>Then you subscribe for the data like it&#x27;s pubsub as well. That would make subscribing to the &quot;event&quot; of 1 or 7 or 100 block confirmations for a set operation have a very similar API to the one for subscribing to events.</p></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/tasitlabs/tasit-sdk/tree/develop/packages/docs/docs/Action.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 40 40" style="margin-right:0.3em;vertical-align:sub"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"></div><div class="pagination-nav__item pagination-nav__item--next"></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_TbNY"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#table-of-contents" class="table-of-contents__link">Table of Contents</a></li><li><a href="#getting-data" class="table-of-contents__link">Getting data</a></li><li><a href="#setting-data" class="table-of-contents__link">Setting data</a></li><li><a href="#listening-for-events" class="table-of-contents__link">Listening for events</a></li><li><a href="#topics-for-the-future" class="table-of-contents__link">Topics for the future</a></li><li><a href="#notes" class="table-of-contents__link">Notes</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Tech</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/introduction">Docs</a></li><li class="footer__item"><a href="https://github.com/orgs/tasitlabs/projects/1" target="_blank" rel="noopener noreferrer" class="footer__link-item">Roadmap</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a href="https://t.me/tasitproject" target="_blank" rel="noopener noreferrer" class="footer__link-item">Telegram</a></li><li class="footer__item"><a href="https://discord.gg/bRp4QKq" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord</a></li><li class="footer__item"><a href="http://feedback.tasit.io/feature-requests" target="_blank" rel="noopener noreferrer" class="footer__link-item">Feature requests</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Social</h4><ul class="footer__items"><li class="footer__item"><a href="https://twitter.com/TasitProject" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter</a></li><li class="footer__item"><a href="https://medium.com/tasit" target="_blank" rel="noopener noreferrer" class="footer__link-item">Medium</a></li></ul></div></div><div class="text--center"><div>Copyright © 2020 Tasit Labs</div></div></div></footer></div>
<script src="/styles.143f7251.js"></script>
<script src="/runtime~main.4f999fc1.js"></script>
<script src="/main.0d28eed8.js"></script>
<script src="/1.88c1c7a9.js"></script>
<script src="/2.50d33069.js"></script>
<script src="/18.8bcd8162.js"></script>
<script src="/19.9269c973.js"></script>
<script src="/20ac7829.cd78ded8.js"></script>
<script src="/17896441.43ff49df.js"></script>
<script src="/2d9fd45f.79f9030e.js"></script>
</body>
</html>